<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nota Dinas - Dashboard</title>
    <link rel="stylesheet" href="assets/css/style.css" />
    <link rel="stylesheet" href="assets/css/nota-dinas.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
    />
  </head>
  <body>
    <div id="sidebar-placeholder"></div>

    <div class="main-content">
      <div id="header-placeholder"></div>

      <!-- TABLE VIEW -->
      <div class="table-view active" id="tableView">
        <div class="container">
          <div class="page-header-new">
            <h1 class="page-title">Nota Dinas</h1>

            <div class="header-controls-list">
              <button class="btn-tambah" onclick="tambahSurat()">
                <i class="bi bi-plus-lg"></i>
                Tambah Baru
              </button>

              <div class="filters-group-compact">
                <div class="filter-icon-btn">
                  <i class="bi bi-funnel"></i>
                  <span>Filter By</span>
                </div>

                <button class="date-picker-btn" id="datePickerBtn">
                  <span id="selectedDateText">14 Feb 2025</span>
                  <i class="bi bi-chevron-down"></i>
                </button>

                <div class="filter-group">
                  <select class="filter-select" id="sifatFilter">
                    <option value="">Sifat: Umum</option>
                    <option value="umum">Umum</option>
                    <option value="rahasia">Rahasia</option>
                    <option value="sangat-rahasia">Sangat Rahasia</option>
                    <option value="penting">Penting</option>
                  </select>
                </div>

                <div class="search-filter">
                  <i class="bi bi-search"></i>
                  <input
                    type="text"
                    placeholder="Ketik Perihal Surat"
                    id="searchPerihal"
                  />
                </div>

                <button class="reset-filter" id="resetBtn">
                  <i class="bi bi-arrow-clockwise"></i>
                  Reset Filter
                </button>
              </div>
            </div>
          </div>

          <!-- CALENDAR MODAL -->
          <div class="calendar-modal" id="calendarModal">
            <div class="calendar-container">
              <div class="calendar-header">
                <h3 id="calendarMonth">February 2025</h3>
                <div class="calendar-nav">
                  <button id="prevMonth">
                    <i class="bi bi-chevron-left"></i>
                  </button>
                  <button id="nextMonth">
                    <i class="bi bi-chevron-right"></i>
                  </button>
                </div>
              </div>

              <div class="calendar-weekdays">
                <div class="calendar-weekday">S</div>
                <div class="calendar-weekday">M</div>
                <div class="calendar-weekday">T</div>
                <div class="calendar-weekday">W</div>
                <div class="calendar-weekday">T</div>
                <div class="calendar-weekday">F</div>
                <div class="calendar-weekday">S</div>
              </div>

              <div class="calendar-days" id="calendarDays"></div>

              <div class="calendar-footer">
                <button class="calendar-apply-btn" id="applyDate">
                  Terapkan
                </button>
              </div>
            </div>
          </div>

          <!-- TABLE -->
          <div class="table-wrapper">
            <table class="table-nota">
              <thead>
                <tr>
                  <th style="width: 60px">No</th>
                  <th style="width: 150px">Tanggal Terima</th>
                  <th style="width: 120px">No Surat</th>
                  <th>Perihal</th>
                  <th style="width: 180px">Dari</th>
                  <th style="width: 200px">Kepada</th>
                  <th style="width: 200px; text-align: center">Opsi</th>
                </tr>
              </thead>
              <tbody id="notaDinasTableBody"></tbody>
            </table>

            <div class="table-footer">
              <span id="paginationInfo">Showing 0-0 of 0</span>
              <div class="pagination">
                <button id="prevPageBtn" disabled>
                  <i class="bi bi-chevron-left"></i>
                </button>
                <button id="nextPageBtn" disabled>
                  <i class="bi bi-chevron-right"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- PREVIEW VIEW -->
      <div class="preview-view" id="previewView">
        <div class="container">
          <div class="preview-page-header">
            <div class="preview-header-left">
              <button class="back-btn" id="backToTableFromPreview">
                <i class="bi bi-chevron-left"></i>
              </button>
              <h2 class="preview-title-main" id="previewTitleMain">Nota Dinas</h2>
            </div>
            <div class="header-actions">
              <button class="icon-btn" onclick="downloadPDF()">
                <i class="bi bi-download"></i>
              </button>
              <button class="icon-btn" onclick="printSurat()">
                <i class="bi bi-printer"></i>
              </button>
              <button class="icon-btn" onclick="hapusSuratFromPreview()">
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </div>

          <div class="preview-grid">
            <!-- DOCUMENT VIEWER - LEFT COLUMN -->
            <div class="document-viewer">
              <div class="doc-placeholder">
                <i class="bi bi-file-earmark-text"></i>
                <p>Preview Dokumen</p>
                <small id="previewFileName">-</small>
              </div>
            </div>

            <!-- RIGHT SECTION - DATA & STATUS CARDS -->
            <div class="preview-right-section">
              <!-- DATA SURAT CARD -->
              <div class="data-surat-card">
                <div class="card-header">
                  <i class="bi bi-file-text"></i>
                  Data Surat
                </div>
                <div class="card-body">
                  <div class="data-row">
                    <div class="data-label">Tanggal Terima</div>
                    <div class="data-value" id="previewTanggalTerima">-</div>
                  </div>
                  <div class="data-row">
                    <div class="data-label">No Surat</div>
                    <div class="data-value" id="previewNoSurat">-</div>
                  </div>
                  <div class="data-row">
                    <div class="data-label">Tanggal Surat</div>
                    <div class="data-value" id="previewTanggalSurat">-</div>
                  </div>
                  <div class="data-row">
                    <div class="data-label">Dari</div>
                    <div class="data-value" id="previewDari">-</div>
                  </div>
                  <div class="data-row">
                    <div class="data-label">Kepada</div>
                    <div class="data-value" id="previewKepada">-</div>
                  </div>
                  <div class="data-row">
                    <div class="data-label">Perihal</div>
                    <div class="data-value" id="previewPerihalDetail">-</div>
                  </div>
                  <div class="data-row">
                    <div class="data-label">Lampiran</div>
                    <div class="data-value" id="previewLampiran">-</div>
                  </div>
                  <div class="data-row">
                    <div class="data-label">Sifat</div>
                    <div class="data-value" id="previewSifat">-</div>
                  </div>
                  <div class="data-row">
                    <div class="data-label">Jenis Naskah</div>
                    <div class="data-value" id="previewJenisNaskah">-</div>
                  </div>
                  <div class="data-row">
                    <div class="data-label">Catatan</div>
                    <div class="data-value" id="previewCatatanDetail">-</div>
                  </div>
                  <div class="data-row">
                    <div class="data-label">Dientry Oleh</div>
                    <div class="data-value" id="previewDientry">-</div>
                  </div>
                </div>
              </div>

              <!-- STATUS SURAT CARD -->
              <div class="status-surat-card">
                <div class="card-header">
                  <i class="bi bi-speedometer2"></i>
                  Status Surat
                </div>
                <div class="card-body">
                  <div class="status-section">
                    <div class="status-label">Status Saat ini</div>
                    <div class="status-badge" id="previewStatusBadge">
                      <span class="badge-proses">Proses</span>
                    </div>
                  </div>
                  
                  <div class="status-section">
                    <div class="status-label">Progress Disposisi</div>
                    <div class="progress-bar-container">
                      <div class="progress-bar" id="previewProgressBar">
                        <div class="progress-fill" style="width: 50%"></div>
                      </div>
                      <div class="progress-text" id="previewProgressText">50%</div>
                    </div>
                  </div>

                  <div class="status-section">
                    <div class="status-label">Update Surat</div>
                    <select class="form-select-status" id="updateSuratStatus">
                      <option value="">Update Surat</option>
                      <option value="proses">Proses</option>
                      <option value="selesai">Selesai</option>
                      <option value="revisi">Perlu Revisi</option>
                      <option value="ditolak">Ditolak</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- FORM VIEW -->
      <div class="form-view" id="formView">
        <div class="container-form">
          <div class="form-header-top">
            <button
              class="back-btn-form"
              id="backToTableViewForm"
              type="button"
            >
              <i class="bi bi-arrow-left"></i>
            </button>
            <h2 class="form-main-title" id="formMainTitle">Susun Nota Dinas</h2>
          </div>

          <div class="progress-steps">
            <div class="step active" data-step="1">
              <div class="step-number">1</div>
              <div class="step-label">Surat</div>
            </div>
            <div class="step-line"></div>
            <div class="step" data-step="2">
              <div class="step-number">2</div>
              <div class="step-label">Tujuan</div>
            </div>
            <div class="step-line"></div>
            <div class="step" data-step="3">
              <div class="step-number">3</div>
              <div class="step-label">Preview</div>
            </div>
          </div>

          <!-- STEP 1 CONTENT -->
          <div class="step-content active" id="step1Content">
            <h3 class="section-title">IDENTITAS PENGIRIM NASKAH</h3>

            <div class="form-row">
              <div class="form-group-half">
                <label class="form-label">Nama Pengirim</label>
                <input
                  type="text"
                  class="form-input"
                  id="namaPengirim"
                  placeholder="Masukkan Nama Pengirim"
                />
              </div>
              <div class="form-group-half">
                <label class="form-label">Jabatan Pengirim</label>
                <input
                  type="text"
                  class="form-input"
                  id="jabatanPengirim"
                  placeholder="Masukkan Jabatan Pengirim"
                />
              </div>
            </div>

            <h3 class="section-title" style="margin-top: 40px">DETAIL ISI</h3>

            <div class="form-row">
              <div class="form-group-half">
                <label class="form-label">Jenis Naskah</label>
                <select class="form-input" id="jenisNaskah">
                  <option value="">Pilih Jenis Naskah</option>
                  <option value="Nota Dinas">Nota Dinas</option>
                  <option value="Surat Dinas">Surat Dinas</option>
                  <option value="Memo">Memo</option>
                </select>
              </div>
              <div class="form-group-half">
                <label class="form-label">Sifat Naskah</label>
                <select class="form-input" id="sifatNaskah">
                  <option value="">Pilih Sifat Naskah...</option>
                  <option value="Umum">Umum</option>
                  <option value="Penting">Penting</option>
                  <option value="Rahasia">Rahasia</option>
                  <option value="Sangat Rahasia">Sangat Rahasia</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group-full">
                <label class="form-label">Nomor Naskah</label>
                <input
                  type="text"
                  class="form-input"
                  id="nomorNaskah"
                  placeholder="Masukkan Nomor Naskah..."
                />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group-half">
                <label class="form-label">Perihal</label>
                <input
                  type="text"
                  class="form-input"
                  id="perihal"
                  placeholder="Masukkan Perihal Surat"
                />
              </div>
              <div class="form-group-half">
                <label class="form-label">Tanggal</label>
                <input type="date" class="form-input" id="tanggalSurat" />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group-half">
                <label class="form-label">Catatan</label>
                <textarea
                  class="form-textarea"
                  id="catatan"
                  placeholder="Masukkan Catatan"
                  rows="4"
                ></textarea>
              </div>
              <div class="form-group-half">
                <label class="form-label">File Naskah</label>
                
                <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                  <input
                    type="file"
                    id="fileInput"
                    accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
                    style="display: none"
                    onchange="handleFileUpload(event)"
                  />
                  
                  <div class="upload-content" id="uploadContent">
                    <i class="bi bi-cloud-arrow-up"></i>
                    <p>Klik untuk unggah file atau seret file ke sini</p>
                    <span>PDF, DOC, DOCX, JPG, PNG (Max 50MB)</span>
                  </div>
                  
                  <div class="file-info-display" id="fileInfoDisplay"></div>
                </div>
              </div>
            </div>

            <div class="form-actions-bottom">
              <button class="btn-next" onclick="goToStep2()">Tambahkan</button>
            </div>
          </div>

          <!-- STEP 2 CONTENT -->
          <div class="step-content" id="step2Content">
            <h3 class="section-title">Tujuan</h3>

            <div class="form-group-full">
              <label class="form-label">Ditujukan Kepada</label>
              <select class="form-input" id="ditujukanKepada">
                <option value="">Ditujukan Kepada</option>
                <option value="Kabag TU">Kabag TU</option>
                <option value="Kabid Infra TIK">Kabid Infra TIK</option>
                <option value="Kabid Banglola Sisfohan">
                  Kabid Banglola Sisfohan
                </option>
                <option value="Kapusdatin Kemhan">Kapusdatin Kemhan</option>
                <option value="Sekretaris">Sekretaris</option>
                <option value="Staff TU">Staff TU</option>
              </select>
            </div>

            <div class="form-group-full">
              <label class="form-label">Tenggat Waktu</label>
              <input type="date" class="form-input" id="tenggatWaktu" />
            </div>

            <div class="form-group-full">
              <label class="form-label">Catatan</label>
              <textarea
                class="form-textarea"
                id="catatanTujuan"
                placeholder="Masukkan Catatan"
                rows="4"
              ></textarea>
            </div>

            <div class="form-actions-bottom">
              <button class="btn-secondary" onclick="goToStep1()">
                Kembali
              </button>
              <button class="btn-next" onclick="goToStep3()">Preview</button>
            </div>
          </div>

          <!-- STEP 3 CONTENT (PREVIEW) -->
          <div class="step-content" id="step3Content">
            <div class="preview-header">
              <h3 class="section-title-main">PREVIEW DATA NOTA DINAS</h3>
              <p class="preview-subtitle">Pastikan semua data sudah benar sebelum mengirim</p>
            </div>

            <div class="preview-section">
              <div class="preview-section-header">
                <i class="bi bi-person-badge"></i>
                <h3 class="section-title">IDENTITAS PENGIRIM NASKAH</h3>
                <button type="button" class="btn-edit-section" onclick="goToStep1()" title="Edit Data Pengirim">
                  <i class="bi bi-pencil-square"></i> Edit
                </button>
              </div>
              
              <div class="preview-card">
                <div class="preview-row">
                  <div class="preview-label">
                    <i class="bi bi-person-circle"></i>
                    Nama Pengirim
                  </div>
                  <div class="preview-value" id="previewNamaPengirim">-</div>
                </div>

                <div class="preview-row">
                  <div class="preview-label">
                    <i class="bi bi-briefcase"></i>
                    Jabatan Pengirim
                  </div>
                  <div class="preview-value" id="previewJabatanPengirim">-</div>
                </div>
              </div>
            </div>

            <div class="preview-section">
              <div class="preview-section-header">
                <i class="bi bi-file-earmark-text"></i>
                <h3 class="section-title">DETAIL ISI NASKAH</h3>
                <button type="button" class="btn-edit-section" onclick="goToStep1()" title="Edit Detail Isi">
                  <i class="bi bi-pencil-square"></i> Edit
                </button>
              </div>
              
              <div class="preview-card">
                <div class="preview-row">
                  <div class="preview-label">
                    <i class="bi bi-tag"></i>
                    Jenis Naskah
                  </div>
                  <div class="preview-value" id="previewJenisNaskahForm">-</div>
                </div>

                <div class="preview-row">
                  <div class="preview-label">
                    <i class="bi bi-shield-lock"></i>
                    Sifat Naskah
                  </div>
                  <div class="preview-value">
                    <span class="badge-sifat" id="previewSifatNaskah">-</span>
                  </div>
                </div>

                <div class="preview-row">
                  <div class="preview-label">
                    <i class="bi bi-hash"></i>
                    Nomor Naskah
                  </div>
                  <div class="preview-value preview-highlight" id="previewNomorNaskah">-</div>
                </div>

                <div class="preview-row">
                  <div class="preview-label">
                    <i class="bi bi-chat-left-text"></i>
                    Perihal
                  </div>
                  <div class="preview-value preview-highlight" id="previewPerihal">-</div>
                </div>

                <div class="preview-row">
                  <div class="preview-label">
                    <i class="bi bi-calendar-event"></i>
                    Tanggal Naskah
                  </div>
                  <div class="preview-value" id="previewTanggalSuratForm">-</div>
                </div>

                <div class="preview-row">
                  <div class="preview-label">
                    <i class="bi bi-sticky"></i>
                    Catatan
                  </div>
                  <div class="preview-value" id="previewCatatan">-</div>
                </div>

                <div class="preview-row">
                  <div class="preview-label">
                    <i class="bi bi-paperclip"></i>
                    File Lampiran
                  </div>
                  <div class="preview-value">
                    <div class="preview-file-info" id="previewFileInfo">
                      <i class="bi bi-file-earmark-pdf"></i>
                      <span id="previewFileNameForm">Tidak ada file</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="preview-section">
              <div class="preview-section-header">
                <i class="bi bi-send"></i>
                <h3 class="section-title">INFORMASI TUJUAN</h3>
                <button type="button" class="btn-edit-section" onclick="goToStep2()" title="Edit Tujuan">
                  <i class="bi bi-pencil-square"></i> Edit
                </button>
              </div>
              
              <div class="preview-card">
                <div class="preview-row">
                  <div class="preview-label">
                    <i class="bi bi-person-check"></i>
                    Ditujukan Kepada
                  </div>
                  <div class="preview-value preview-highlight" id="previewTujuan">-</div>
                </div>

                <div class="preview-row">
                  <div class="preview-label">
                    <i class="bi bi-alarm"></i>
                    Tenggat Waktu
                  </div>
                  <div class="preview-value">
                    <span class="badge-deadline" id="previewTenggatWaktu">-</span>
                  </div>
                </div>

                <div class="preview-row">
                  <div class="preview-label">
                    <i class="bi bi-chat-square-dots"></i>
                    Catatan Tujuan
                  </div>
                  <div class="preview-value preview-text-area" id="previewCatatanTujuan">-</div>
                </div>
              </div>
            </div>

            <div class="preview-warning-box">
              <div class="warning-icon">
                <i class="bi bi-exclamation-triangle-fill"></i>
              </div>
              <div class="warning-content">
                <h4>Perhatian!</h4>
                <p>Pastikan semua data sudah benar. Setelah dikirim, nota dinas akan masuk ke sistem dan tidak dapat diubah kecuali dengan persetujuan admin.</p>
              </div>
            </div>

            <div class="form-actions-bottom">
              <button type="button" class="btn-secondary" onclick="goToStep2()">
                Kembali
              </button>
              <button type="button" class="btn-submit" onclick="confirmSubmitNotaDinas()">
                <i class="bi bi-check-circle"></i>
                Konfirmasi & Kirim
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- SUCCESS POPUP -->
      <div class="success-popup" id="successPopup">
        <div class="success-content">
          <button class="close-btn-popup" onclick="closeSuccessPopupAndBack()">
            <i class="bi bi-x-lg"></i>
          </button>

          <h2 class="popup-title">Nota Dinas Berhasil Ditambahkan</h2>
          <div class="check-circle-icon">
            <i class="bi bi-check-lg"></i>
          </div>

          <p class="popup-note">Siapkan tempat dan undangan</p>
        </div>
      </div>

      <div id="footer-placeholder"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <script src="assets/js/firebase-config.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="assets/js/database.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="assets/js/nota-dinas.js"></script>
  </body>
</html>